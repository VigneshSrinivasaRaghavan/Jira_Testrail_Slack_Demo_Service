version: '3.8'
services:
  jira-mock:
    build: ./mock-services/jira-mock
    ports:
      - "4001:4001"
    volumes:
      - ./mock-services/jira-mock:/app
      - jira_db:/app/jira.db
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4001/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  testrail-mock:
    build: ./mock-services/testrail-mock
    ports:
      - "4002:4002"
    volumes:
      - ./mock-services/testrail-mock:/app
      - testrail_db:/app/data
    environment:
      - MOCK_AUTH_REQUIRED=true
      - ENABLE_RATE_LIMIT=false
      - TESTRAIL_PROJECT_ID=1
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4002/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    depends_on:
      - jira-mock

  slack-mock:
    build: ./mock-services/slack-mock
    ports:
      - "4003:4003"
    volumes:
      - ./mock-services/slack-mock:/app
      - slack_db:/app/data
    environment:
      - MOCK_AUTH_REQUIRED=true
      - ENABLE_RATE_LIMIT=false
      - DEFAULT_SLACK_CHANNEL=qa-reports
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4003/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    depends_on:
      - jira-mock
      - testrail-mock

volumes:
  jira_db:
  testrail_db:
  slack_db:
